<!DOCTYPE html>
<html>
  <head>
    <title>Resultado de la Búsqueda</title>
    <link rel="stylesheet" href="/css/styles.css" />
    <link rel="stylesheet" href="/css/index.css" />
  </head>
  <body class="page-content">
    <nav class="navbar visible">
      <div class="nav-container">
        <a href="/" class="nav-brand">The Movies</a>
        <div class="nav-filters">
          <a href="#">Acción</a>
          <a href="#">Comedia</a>
          <a href="#">Drama</a>
          <a href="#">Terror</a>
        </div>
        <form class="nav-search" action="/buscar" method="GET">
          <input
            type="text"
            name="q"
            value="<%= toSearch %>"
            placeholder="Buscar películas..."
          />
          <button type="submit">Buscar</button>
        </form>
      </div>
    </nav>

    <div class="tabs-container">
    <div class="tab-nav">
      <a href="/buscar?q=<%= toSearch %>&tab=peliculas" class="tab-button" data-tab="peliculas">Películas</a>
      <a href="/buscar?q=<%= toSearch %>&tab=actores" class="tab-button" data-tab="actores">Actores</a>
      <a href="/buscar?q=<%= toSearch %>&tab=directores" class="tab-button" data-tab="directores">Directores</a>
    </div>

      <div class="tab-content">
        <div id="peliculas-panel" class="tab-panel">
          <% if (movies.rows.length === 0) { %>
          <p class="no-results">No se encontraron películas.</p>
          <% } else { %>
          <div class="results-grid">
            <% movies.rows.forEach(movie => { %>
            <a href="/pelicula/<%= movie.movie_id %>" class="result-card">
              <img
                class="card-img"
                src="/imgs/poster.jpg"
                alt="Poster de <%= movie.title %>"
              />
              <div class="card-info">
                <h3 class="card-title"><%= movie.title %></h3>
                <% if (movie.priority == 3) {%>
                  <span>Relacionado</span>
                <%}%>
              </div>
            </a>
            <% }); %>
          </div>
          <% if (movies.totalPages > 1) { %>
          <div class="pagination">
            <a
              href="/buscar?q=<%= toSearch %>&page=<%= currentPage - 1 %>&tab=peliculas"
              class="page-link <%= currentPage === 1 ? 'disabled' : '' %>"
              ><</a
            >
            <% if (movies.totalPages > 10) { %>
            <span class="page-info"
              >Página <%= currentPage %> de <%= movies.totalPages %></span
            >
            <% } else { %> <% for (let i = 1; i <= movies.totalPages; i++) { %>
            <a
              href="/buscar?q=<%= toSearch %>&page=<%= i %>&tab=peliculas"
              class="page-link <%= i === currentPage ? 'active' : '' %>"
              ><%= i %></a
            >
            <% } %> <% } %>
            <a
              href="/buscar?q=<%= toSearch %>&page=<%= currentPage + 1 %>&tab=peliculas"
              class="page-link <%= currentPage >= movies.totalPages ? 'disabled' : '' %>"
              >></a
            >
          </div>
          <% } %> <% } %>
        </div>

        <div id="actores-panel" class="tab-panel">
          <% if (actors.rows.length === 0) { %>
          <p class="no-results">No se encontraron actores.</p>
          <% } else { %>
          <div class="results-grid">
            <% actors.rows.forEach(actor => { %>
            <a href="/actor/<%= actor.person_id %>" class="result-card">
              <img
                class="card-img"
                src="/imgs/Tom_Hanks.jpg"
                alt="Foto de <%= actor.person_name %>"
              />
              <div class="card-info">
                <h3 class="card-title"><%= actor.person_name %></h3>
              </div>
            </a>
            <% }); %>
          </div>
          <% if (actors.totalPages > 1) { %>
          <div class="pagination">
            <a
              href="/buscar?q=<%= toSearch %>&page=<%= currentPage - 1 %>&tab=actores"
              class="page-link <%= currentPage === 1 ? 'disabled' : '' %>"
              ><</a
            >
            <% if (actors.totalPages > 10) { %>
            <span class="page-info"
              >Página <%= currentPage %> de <%= actors.totalPages %></span
            >
            <% } else { %> <% for (let i = 1; i <= actors.totalPages; i++) { %>
            <a
              href="/buscar?q=<%= toSearch %>&page=<%= i %>&tab=actores"
              class="page-link <%= i === currentPage ? 'active' : '' %>"
              ><%= i %></a
            >
            <% } %> <% } %>
            <a
              href="/buscar?q=<%= toSearch %>&page=<%= currentPage + 1 %>&tab=actores"
              class="page-link <%= currentPage >= actors.totalPages ? 'disabled' : '' %>"
              >></a
            >
          </div>
          <% } %> <% } %>
        </div>

        <div id="directores-panel" class="tab-panel">
          <% if (directors.rows.length === 0) { %>
          <p class="no-results">No se encontraron directores.</p>
          <% } else { %>
          <div class="results-grid">
            <% directors.rows.forEach(director => { %>
            <a href="/director/<%= director.person_id %>" class="result-card">
              <img
                class="card-img"
                src="/imgs/Tom_Hanks.jpg"
                alt="Foto de <%= director.person_name %>"
              />
              <div class="card-info">
                <h3 class="card-title"><%= director.person_name %></h3>
              </div>
            </a>
            <% }); %>
          </div>
          <% if (directors.totalPages > 1) { %>
          <div class="pagination">
            <a
              href="/buscar?q=<%= toSearch %>&page=<%= currentPage - 1 %>&tab=directores"
              class="page-link <%= currentPage === 1 ? 'disabled' : '' %>"
              ><</a
            >
            <% if (directors.totalPages > 10) { %>
            <span class="page-info"
              >Página <%= currentPage %> de <%= directors.totalPages %></span
            >
            <% } else { %> <% for (let i = 1; i <= directors.totalPages; i++) {
            %>
            <a
              href="/buscar?q=<%= toSearch %>&page=<%= i %>&tab=directores"
              class="page-link <%= i === currentPage ? 'active' : '' %>"
              ><%= i %></a
            >
            <% } %> <% } %>
            <a
              href="/buscar?q=<%= toSearch %>&page=<%= currentPage + 1 %>&tab=directores"
              class="page-link <%= currentPage >= directors.totalPages ? 'disabled' : '' %>"
              >></a
            >
          </div>
          <% } %> <% } %>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const tabButtons = document.querySelectorAll(".tab-button");
        const tabPanels = document.querySelectorAll(".tab-panel");
        const activeTabName =
          '<%= typeof activeTab !== "undefined" ? activeTab : "peliculas" %>';

        // Función para cambiar de pestaña
        function switchTab(tabName) {
          tabButtons.forEach((btn) => btn.classList.remove("active"));
          tabPanels.forEach((panel) => panel.classList.remove("active"));

          const buttonToActivate = document.querySelector(
            `.tab-button[data-tab="${tabName}"]`
          );
          const panelToActivate = document.getElementById(`${tabName}-panel`);

          if (buttonToActivate) buttonToActivate.classList.add("active");
          if (panelToActivate) panelToActivate.classList.add("active");
        }

        // Activar la pestaña correcta al cargar la página
        switchTab(activeTabName);
      });
    </script>
  </body>
</html>
