<!DOCTYPE html>
<html>
  <head>
    <title>Resultado de la Búsqueda</title>
    <link rel="stylesheet" href="/css/styles.css" />
    <link rel="stylesheet" href="/css/index.css" />
  </head>
  <body class="page-content">
    <nav class="navbar visible">
      <div class="nav-container">
        <a href="/" class="nav-brand">The Movies</a>
        <div class="nav-filters">
          <a href="#">Acción</a>
          <a href="#">Comedia</a>
          <a href="#">Drama</a>
          <a href="#">Terror</a>
        </div>
        <form class="nav-search" action="/buscar" method="GET">
          <input
            type="text"
            name="q"
            value="<%= toSearch %>"
            placeholder="Buscar películas..."
          />
          <button type="submit">Buscar</button>
        </form>
      </div>
    </nav>


    <div class="tabs-container">
      <div class="tab-nav">
        <button class="tab-button <%= !(movies.byTitle.length + movies.related.length) && !actors.length && !directors.length ? 'active' : !(movies.byTitle.length + movies.related.length) ? '' : 'active' %> " data-tab="peliculas">
          Películas (<%= movies.byTitle.length + movies.related.length %>)
        </button>
        <button class="tab-button <%= !(movies.byTitle.length + movies.related.length) && actors.length ? 'active' : '' %>" data-tab="actores">
          Actores (<%= actors.length %>)
        </button>
        <button class="tab-button <%= !(movies.byTitle.length + movies.related.length) && !actors.length && directors.length%>" data-tab="directores">
          Directores (<%= directors.length %>)
        </button>
      </div>

      <div class="tab-content">
        <div id="peliculas-panel" class="tab-panel active">
          <% if (movies.byTitle.length === 0 && movies.related.length === 0) { %>
          <p class="no-results">No se encontraron películas.</p>
          <% } else { %>
          <div class="results-grid">
            <% movies.byTitle.forEach((movie) => { %>
            <a href="/pelicula/<%= movie.movie_id %>" class="result-card">
              <img
                class="card-img"
                src="/imgs/poster.jpg"
                alt="Poster de <%= movie.title %>"
              />
              <div class="card-info">
                <h3 class="card-title"><%= movie.title %></h3>
              </div>
            </a>
            <% }); %>
            <% movies.related.forEach((movie) => { %>
            <a href="/pelicula/<%= movie.movie_id %>" class="result-card">
              <img
                class="card-img"
                src="/imgs/poster.jpg"
                alt="Poster de <%= movie.title %>"
              />
              <div class="card-info">
                <h3 class="card-title"><%= movie.title %></h3>
                <span>Relacionado</span>
              </div>
            </a>
            <% }); %>
          </div>
          <% } %>
        </div>

        <div id="actores-panel" class="tab-panel">
          <% if (actors.length === 0) { %>
          <p class="no-results">No se encontraron actores.</p>
          <% } else { %>
          <div class="results-grid">
            <% actors.forEach((actor) => { %>
            <a href="/actor/<%= actor.person_id %>" class="result-card">
              <img
                class="card-img"
                src="/imgs/Tom_Hanks.jpg"
                alt="Foto de <%= actor.person_name %>"
              />
              <div class="card-info">
                <h3 class="card-title"><%= actor.person_name %></h3>
              </div>
            </a>
            <% }); %>
          </div>
          <% } %>
        </div>

        <div id="directores-panel" class="tab-panel">
          <% if (directors.length === 0) { %>
          <p class="no-results">No se encontraron directores.</p>
          <% } else { %>
          <div class="results-grid">
            <% directors.forEach((director) => { %>
            <a href="/director/<%= director.person_id %>" class="result-card">
              <img
                class="card-img"
                src="/imgs/Tom_Hanks.jpg"
                alt="Foto de <%= director.person_name %>"
              />
              <div class="card-info">
                <h3 class="card-title"><%= director.person_name %></h3>
              </div>
            </a>
            <% }); %>
          </div>
          <% } %>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const tabButtons = document.querySelectorAll(".tab-button");
        const tabPanels = document.querySelectorAll(".tab-panel");
        
        tabButtons.forEach((button) => {
          const targetPanelId = button.dataset.tab + "-panel";
          if (button.classList.contains('active')) 
            document.getElementById(targetPanelId).classList.add("active");
          else 
            document.getElementById(targetPanelId).classList.remove("active");
        })

        tabButtons.forEach((button) => {
          button.addEventListener("click", () => {
            // Quitar 'active' de todos los botones y paneles
            tabButtons.forEach((btn) => btn.classList.remove("active"));
            tabPanels.forEach((panel) => panel.classList.remove("active"));

            // Añadir 'active' al botón clickeado y al panel correspondiente
            button.classList.add("active");
            const targetPanelId = button.dataset.tab + "-panel";
            document.getElementById(targetPanelId).classList.add("active");
          });
        });
      });
    </script>
  </body>
</html>
